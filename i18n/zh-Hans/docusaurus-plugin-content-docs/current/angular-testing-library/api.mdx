---
id: api
title: API
sidebar_label: API
---

`Angular Testing Library`é‡æ–°å¯¼å‡ºäº† `DOM Testing Library` çš„æ‰€æœ‰å†…å®¹ä»¥åŠ `render` æ–¹æ³•ã€‚

ä»¥ä¸‹çš„é‡æ–°å¯¼å‡ºæ˜¯ç»è¿‡ patch çš„ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸Angularä¸€èµ·ä½¿ç”¨ï¼š

- `fireEvent` ä¸Šçš„äº‹ä»¶åœ¨äº‹ä»¶è¢«è§¦å‘åè‡ªåŠ¨è°ƒç”¨ä¸€ä¸ªå˜åŒ–æ£€æµ‹å‘¨æœŸ
- `findBy` æŸ¥è¯¢ä¼šåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰è‡ªåŠ¨è°ƒç”¨ä¸€ä¸ªå˜åŒ–æ£€æµ‹å‘¨æœŸ
- `waitFor` å‡½æ•°åœ¨è°ƒç”¨å›è°ƒå‡½æ•°ä¹‹å‰è‡ªåŠ¨è°ƒç”¨ä¸€ä¸ªå˜åŒ–æ£€æµ‹å‘¨æœŸ

## `render`

é€šè¿‡Angular Testing Libraryï¼Œå¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¸²æŸ“ç»„ä»¶ï¼Œé€šè¿‡ç»„ä»¶çš„ç±»å‹æˆ–ç”¨æ¨¡æ¿ã€‚

> é»˜è®¤æƒ…å†µä¸‹ï¼Œ`render` ä¹Ÿä¼šå¯¼å…¥ `NoopAnimationsModule`ã€‚

## `Type`

è¦æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼Œä½ éœ€è¦å°†ç»„ä»¶çš„ç±»å‹ä¼ é€’ç»™ `render` æ–¹æ³•ã€‚å¯¹äºä¸ä½¿ç”¨ä½ çš„åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†çš„ç»„ä»¶ï¼ˆä¾‹å¦‚è®¾è®¡æ¨¡å—æˆ–æœåŠ¡ï¼‰ï¼Œ
æ¸²æŸ“ä¸€ä¸ªç»„ä»¶å¯ä»¥åƒä¸‹é¢çš„ä¾‹å­ä¸€æ ·ç®€å•ã€‚

```typescript
await render(AppComponent)
```

## `template`

ä½ ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªæ¨¡æ¿ï¼Œè€Œä¸æ˜¯æŠŠç»„ä»¶çš„ç±»å‹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚è¿™ç§åšæ³•æ˜¯æ¸²æŸ“æŒ‡ä»¤æ‰€éœ€è¦çš„ï¼Œ
ä½†ä¹Ÿå¯ä»¥åº”ç”¨äºç»„ä»¶ï¼Œå®ƒç”šè‡³å¯èƒ½æ›´æœ‰ç”¨ã€‚ç„¶åï¼ŒæŒ‡ä»¤çš„ï¼ˆæˆ–ç»„ä»¶çš„ï¼‰ç±»å‹å¿…é¡»è¢«æ·»åŠ åˆ° `declarations` ä¸­ã€‚

**æŒ‡ä»¤ç¤ºä¾‹**:

```typescript
await render('<div appSpoiler></div>', {
  declarations: [SpoilerDirective],
})
```

**ç»„ä»¶ç¤ºä¾‹**:

```typescript
await render(
  '<app-component [value]="47" [otherValue]="anotherValue" (sendValue)="sendValue($event)"></app-component>',
  {
    declarations: [AppComponent],
    componentProperties: {
      anotherValue: 'valueOfAnotherProperty',
      sendValue: jest.fn(),
    },
  },
)
```

```typescript
export async function render<ComponentType>(
  component: Type<ComponentType>,
  renderOptions?: RenderComponentOptions<ComponentType>,
): Promise<RenderResult<ComponentType, ComponentType>>
export async function render<WrapperType = WrapperComponent>(
  template: string,
  renderOptions?: RenderTemplateOptions<WrapperType>,
): Promise<RenderResult<WrapperType>>
```

## Component RenderOptions

### `componentInputs`

ç”¨äºè®¾ç½®ç»„ä»¶çš„`@Input`å±æ€§çš„å¯¹è±¡ã€‚ä½¿ç”¨`setInput`è®¾ç½®è¾“å…¥å±æ€§ã€‚å¦‚æœç»„ä»¶å±æ€§æœªä½¿ç”¨`@Input`å±æ€§è¿›è¡Œæ³¨é‡Šï¼Œåˆ™æŠ›å‡ºã€‚

**é»˜è®¤å€¼** : `{}`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  componentInputs: {
    counterValue: 10,
  },
})
```

### `componentOutputs`

ç”¨äºè®¾ç½®ç»„ä»¶çš„`@Output`å±æ€§çš„å¯¹è±¡ã€‚

**é»˜è®¤å€¼** : `{}`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  componentOutputs: {
    clicked: (value) => { ... }
  }
})
```

### `componentProperties`

ä¸€ä¸ªç”¨äºè®¾ç½®ç»„ä»¶çš„ `@Input` å’Œ `@Output` å±æ€§çš„å¯¹è±¡ã€‚æ²¡æœ‰åƒ `componentInputs`å’Œ`componentOutputs`é‚£æ ·çš„ç»†ç²’åº¦æ§åˆ¶ã€‚

**é»˜è®¤** : `{}`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  // an input
    counterValue: 10,
    // an output
    send: (value) => { ... }
    // a public property
    name: 'Tim'
})
```

### `declarations`

æ¸²æŸ“è¯¥ç»„ä»¶æ‰€éœ€çš„ç»„ä»¶ã€æŒ‡ä»¤å’Œç®¡é“çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œç»„ä»¶çš„åµŒå¥—ç»„ä»¶ã€‚

æ›´å¤šä¿¡æ¯è§[Angularæ–‡æ¡£](https://angular.io/api/core/Directive#providers)ã€‚

**é»˜è®¤** : `[]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  declarations: [CustomerDetailComponent, ButtonComponent],
})
```

### `componentProviders`

é€šè¿‡ä¾èµ–æ³¨å…¥æ¸²æŸ“ç»„ä»¶æ‰€éœ€çš„æä¾›è€…çš„é›†åˆã€‚

è¿™äº›å°†åœ¨ç»„ä»¶çº§åˆ«ä¸Šæä¾›ã€‚è¦æƒ³åœ¨æ¨¡å—å±‚é¢ä¸Šæ³¨å…¥ä¾èµ–å…³ç³»ï¼Œè¯·ä½¿ç”¨[`providers`](#providers)ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚è§[Angularæ–‡æ¡£](https://angular.io/api/core/Directive#providers)ã€‚

**é»˜è®¤** : `[]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  componentProviders: [AppComponentService],
})
```

### `ÉµcomponentImports`

ä¸€ä¸ªå¯¼å…¥çš„é›†åˆï¼Œç”¨æ¥è¦†ç›–ä¸€ä¸ªç‹¬ç«‹ç»„ä»¶çš„å¯¼å…¥ã€‚

**é»˜è®¤** : `undefined`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
    ÉµcomponentImports: [
        componentImports: [MockChildComponent],
    ]
})
```

### `childComponentOverrides`

ç”¨äºè¦†ç›–çš„å­ç»„ä»¶æŒ‡å®šæä¾›è€…çš„é›†åˆã€‚

**é»˜è®¤** : `undefined`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  childComponentOverrides: [
    {
      component: ChildOfAppComponent,
      providers: [{provide: ChildService, useValue: {hello: 'world'}}],
    },
  ],
})
```

### `detectChangesOnRender`

å½“ç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼Œå°†è°ƒç”¨ `detectChanges`ã€‚

**é»˜è®¤** : `true`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {detectChangesOnRender: false})
```

### `autoDetectChanges`

åƒâ€œå®é™…â€è¿è¡Œçš„ç»„ä»¶ä¸€æ ·è‡ªåŠ¨æ£€æµ‹æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œåœ¨å‘ç”Ÿäº‹ä»¶æ—¶è¿è¡Œæ›´æ”¹æ£€æµ‹å‘¨æœŸã€‚

**é»˜è®¤** : `true`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  autoDetectChanges: false,
})
```

### `excludeComponentDeclaration`

æ’é™¤è¢«è‡ªåŠ¨æ·»åŠ ä¸ºå£°æ˜çš„ç»„ä»¶ã€‚å½“ç»„ä»¶åœ¨å¯¼å…¥çš„æ¨¡å—ä¸­è¢«å£°æ˜æ—¶éœ€è¦è¿™æ ·åšï¼Œä¾‹å¦‚ç”¨SCAMsã€‚

**é»˜è®¤** : `false`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  imports: [AppModule], // a module that includes AppComponent
  excludeComponentDeclaration: true,
})
```

### `imports`

æ¸²æŸ“ç»„ä»¶æ‰€éœ€çš„å¯¼å…¥é›†åˆï¼Œä¾‹å¦‚ï¼Œå…±äº«æ¨¡å—ã€‚å¦‚æœ `BrowserAnimationsModule` æ²¡æœ‰è¢«æ·»åŠ åˆ°é›†åˆä¸­ï¼Œé»˜è®¤ä¼šæ·»åŠ  `NoopAnimationsModule`ã€‚

æ›´å¤šä¿¡æ¯è§[Angularæ–‡æ¡£](https://angular.io/api/core/NgModule#imports)ã€‚

**é»˜è®¤** : `[NoopAnimationsModule]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  imports: [AppSharedModule, MaterialModule],
})
```

### `providers`

é€šè¿‡ä¾èµ–æ€§æ³¨å…¥æ¸²æŸ“ç»„ä»¶æ‰€éœ€çš„æä¾›è€…é›†åˆã€‚

è¿™äº›å°†åœ¨æ¨¡å—çº§åˆ«ä¸Šæä¾›ã€‚è¦åœ¨ç»„ä»¶çº§åˆ«ä¸Šæ³¨å…¥ä¾èµ–å…³ç³»ï¼Œè¯·ä½¿ç”¨ [`componentProviders`](#componentProviders)

æ›´å¤šä¿¡æ¯è¯·å‚è§[Angularæ–‡æ¡£](https://angular.io/api/core/NgModule#providers)ã€‚

**é»˜è®¤** : `[]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  providers: [
    CustomersService,
    {
      provide: MAX_CUSTOMERS_TOKEN,
      useValue: 10,
    },
  ],
})
```

### `queries`

è¦ç»‘å®šçš„æŸ¥è¯¢ã€‚è¦†ç›–DOMæµ‹è¯•åº“çš„é»˜è®¤è®¾ç½®ï¼Œé™¤éåˆå¹¶ã€‚

**é»˜è®¤** : `undefined`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  queries: {...queries, ...customQueries},
})
```

### `routes`

é€šè¿‡ `RouterTestingModule.withRoutes` è®¾ç½®è·¯ç”±å™¨æœåŠ¡çš„è·¯ç”±é…ç½®ã€‚
æ›´å¤šä¿¡æ¯è§[Angular Routesæ–‡æ¡£](https://angular.io/api/router/Routes)ã€‚

**é»˜è®¤** : `[]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  declarations: [ChildComponent],
  routes: [
    {
      path: '',
      children: [
        {
          path: 'child/:id',
          component: ChildComponent,
        },
      ],
    },
  ],
})
```

### `schemas`

æ¸²æŸ“è¯¥ç»„ä»¶æ‰€éœ€çš„æ¨¡å¼é›†åˆã€‚å…è®¸çš„å€¼æ˜¯ `NO_ERRORS_SCHEMA` å’Œ `CUSTOM_ELEMENTS_SCHEMA`ã€‚

æ›´å¤šä¿¡æ¯è§[Angularæ–‡æ¡£](https://angular.io/api/core/NgModule#schemas)ã€‚

**é»˜è®¤** : `[]`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  schemas: [NO_ERRORS_SCHEMA],
})
```

### `removeAngularAttributes`

ç§»é™¤å¤¹å…·ä¸­çš„Angularå±æ€§ï¼ˆng-versionå’Œroot-idï¼‰ã€‚

**é»˜è®¤** : `false`

**ç¤ºä¾‹**:

```typescript
await render(AppComponent, {
  removeAngularAttributes: true,
})
```

## `RenderResult`

### `container`

ä½ æ¸²æŸ“çš„Angular Componentçš„åŒ…å«DOMèŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„DOMèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä½ å¯ä»¥è°ƒç”¨ `container.querySelector` ç­‰æ¥æ£€æŸ¥å­èŠ‚ç‚¹ã€‚

### `debug`

æ‰“å°å‡ºç»„ä»¶çš„DOMï¼Œå¹¶æœ‰è¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚æ¥å—ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œä»¥æ‰“å°å‡ºä¸€ä¸ªç‰¹å®šçš„DOMèŠ‚ç‚¹ã€‚

```typescript
const {debug} = await render(AppComponent)

debug()
```

### `change`

æ”¹å˜ç»„ä»¶çš„è¾“å…¥ã€‚è¿™åœ¨é“å…·æ›´æ–°åè°ƒç”¨ `detectChanges`ã€‚

```typescript
const {change} = await render(Counter, {
  componentProperties: {count: 4, name: 'Sarah'},
})

expect(screen.getByTestId('count-value').textContent).toBe('4')
expect(screen.getByTestId('name-value').textContent).toBe('Sarah')

change({count: 7})

// count updated to 7
expect(screen.getByTestId('count-value').textContent).toBe('7')
// name keeps the same value
expect(screen.getByTestId('name-value').textContent).toBe('Sarah')
```

### `rerender`

åˆ›å»ºå¹¶æ¸²æŸ“ä¸€ä¸ªæ–°çš„ç»„ä»¶å®ä¾‹ã€‚æ²¡æœ‰å®šä¹‰çš„è¾“å…¥å±æ€§ä¼šè¢«æ¸…é™¤ã€‚è¦ä¿ç•™å®ƒä»¬ï¼Œè¯·ä½¿ç”¨[change](#change)ã€‚

```typescript
const {rerender} = await render(Counter, {
  componentProperties: {count: 4, name: 'Sarah'},
})

expect(screen.getByTestId('count-value').textContent).toBe('4')
expect(screen.getByTestId('name-value').textContent).toBe('Sarah')

await rerender({count: 7})

// count updated to 7
expect(screen.getByTestId('count-value').textContent).toBe('7')
// name is undefined because it's not provided in rerender
expect(screen.getByTestId('name-value').textContent).toBeUndefined()
```

### `detectChanges`

è§¦å‘è¯¥ç»„ä»¶çš„å˜åŒ–æ£€æµ‹å‘¨æœŸã€‚

æ›´å¤šä¿¡æ¯è§[Angularæ–‡æ¡£](https://angular.io/api/core/testing/ComponentFixture#detectChanges)ã€‚

### `debugElement`

è¯¥ç»„ä»¶çš„Angular `DebugElement`ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚è§[Angularæ–‡æ¡£](https://angular.io/api/core/DebugElement)ã€‚

### `fixture`

è¯¥ç»„ä»¶çš„Angular `ComponentFixture`ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚è§[Angularæ–‡æ¡£](https://angular.io/api/core/testing/ComponentFixture)ã€‚

```typescript
const {fixture} = await render(AppComponent)

// componentInstance is typed as AppComponent
const componentInstance = fixture.componentInstance
```

> ğŸš¨ å¦‚æœä½ å‘ç°è‡ªå·±ä½¿ç”¨ `fixture` æ¥è®¿é—®ç»„ä»¶çš„å†…éƒ¨å€¼ï¼Œä½ åº”è¯¥é‡æ–°è€ƒè™‘ï¼
> è¿™å¯èƒ½æ„å‘³ç€ä½ æ­£åœ¨æµ‹è¯•å®ç°ç»†èŠ‚ã€‚

### `navigate`

æ¥å—ä¸€ä¸ªDOMå…ƒç´ æˆ–ä¸€ä¸ªè·¯å¾„ä½œä¸ºå‚æ•°ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ è¢«ä¼ é€’ï¼Œ`navigate` å°†å¯¼èˆªåˆ°è¯¥å…ƒç´ çš„ `href` å€¼ã€‚
å¦‚æœä¼ é€’äº†ä¸€ä¸ªè·¯å¾„ï¼Œ`navigate` å°†å¯¼èˆªåˆ°è¯¥è·¯å¾„ã€‚

```typescript
const { navigate } = await render(AppComponent, {
  routes: [...]
})

await navigate(component.getByLabelText('To details'))
await navigate('details/3')
```

### `...queries`

`render` æœ€é‡è¦çš„ç‰¹ç‚¹æ˜¯ï¼Œ[DOM Testing Library](/docs/dom-testing-library/intro) çš„æŸ¥è¯¢ä¼šè‡ªåŠ¨è¿”å›ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸è¢«æµ‹ç»„ä»¶ç»‘å®šã€‚

å®Œæ•´çš„åˆ—è¡¨è§[æŸ¥è¯¢](queries/about.mdx)ã€‚

**ç¤ºä¾‹**:

```typescript
const {getByText, queryByLabelText} = await render(AppComponent)

screen.getByRole('heading', {
  name: /api/i,
})
queryByLabelText(/First name/i')
```
