---
id: api
title: API
sidebar_label: API
---

- [`@testing-library/dom`](#testing-library-dom)
- [`render`](#render)
- [`cleanup`](#cleanup)
- [`act`](#act-async)
- [`fireEvent`](#fireevent-async)

---

## `@testing-library/dom`

è¿™ä¸ªåº“é‡æ–°å¯¼å‡ºäº†DOM Testing Libraryï¼ˆ@testing-library/domï¼‰çš„æ‰€æœ‰å†…å®¹ã€‚
è¯·çœ‹[æ–‡æ¡£](queries/about.mdx)ä»¥äº†è§£ä½ å¯ä»¥ä½¿ç”¨å“ªäº›å¥½ä¸œè¥¿ã€‚

ğŸ“ å½“ä» `@testing-library/svelte` å¯¼å…¥æ—¶ï¼Œ`fireEvent` æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ã€‚
è¿™æ˜¯å› ä¸ºå®ƒè°ƒç”¨ [`tick`][svelte-tick]ï¼Œå‘Šè¯‰Svelteå°†ä»»ä½•æ–°çš„å˜åŒ–åº”ç”¨åˆ°DOMä¸Šã€‚

## `render`

```js
import {render} from '@testing-library/svelte'

const {results} = render(YourComponent, {ComponentOptions}, {RenderOptions})
```

### ç»„ä»¶é€‰é¡¹

è¿™äº›æ˜¯ä½ åœ¨å®ä¾‹åŒ–ä½ çš„Svelte `Component` æ—¶ä¼ é€’çš„é€‰é¡¹ã€‚
è¯·å‚è€ƒ[å®¢æˆ·ç«¯ç»„ä»¶çš„API](https://svelte.dev/docs#run-time-client-side-component-api-creating-a-component)ã€‚

ğŸ“ å¦‚æœä½ è¦ä¼ å…¥çš„å”¯ä¸€é€‰é¡¹æ˜¯ `props`ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä¼ å…¥å®ƒä»¬ã€‚

```js
// With options.
const {results} = render(YourComponent, {
  target: MyTarget,
  props: {myProp: 'value'},
})

// Props only.
const {results} = render(YourComponent, {myProp: 'value'})
```

### æ¸²æŸ“é€‰é¡¹

| Option      | Description                                                                         | Default         |
| ----------- | ----------------------------------------------------------------------------------- | --------------- |
| `container` | The HTML element the component is mounted into.                                     | `document.body` |
| `queries`   | Queries to bind to the container. See [within](dom-testing-library/api-within.mdx). | `null`          |

### è¿”å›ç»“æœ

| Result       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `container`  | The HTML element the component is mounted into.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `component`  | The newly created Svelte component. Generally, this should only be used when testing exported functions, or when you're testing developer facing API's. Outside of said cases avoid using the component directly to build tests, instead of interacting with the rendered Svelte component, work with the DOM. Have a read of [Avoid the Test User](https://kentcdodds.com/blog/avoid-the-test-user) by Kent C. Dodds to understand the difference between the **end user** and **developer user**. |
| `debug`      | Logs the `container` using [prettyDom](dom-testing-library/api-debugging.mdx/#prettydom).                                                                                                                                                                                                                                                                                                                                                                                                           |
| `unmount`    | Unmounts the component from the `target` by calling `component.$destroy()`.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `rerender`   | Calls render again destroying the old component, and mounting the new component on the original `target` with any new options passed in.                                                                                                                                                                                                                                                                                                                                                            |
| `...queries` | Returns all [query functions](queries/about.mdx) that are bound to the `container`. If you pass in `query` arguments than this will be those, otherwise all.                                                                                                                                                                                                                                                                                                                                        |

## `cleanup`

> ä½ ä¸éœ€è¦å¯¼å…¥æˆ–ä½¿ç”¨è¿™ä¸ªï¼Œå®ƒæ˜¯è‡ªåŠ¨ä¸ºä½ å®Œæˆçš„!

ä»å®¹å™¨ä¸­å¸è½½ç»„ä»¶å¹¶é”€æ¯å®¹å™¨ã€‚

ğŸ“ å½“ä½ ä»åº“ä¸­å¯¼å…¥ä»»ä½•ä¸œè¥¿æ—¶ï¼Œè¿™å°†åœ¨æ¯æ¬¡æµ‹è¯•åè‡ªåŠ¨è¿è¡Œã€‚å¦‚æœä½ æƒ³ç¦ç”¨å®ƒï¼Œ
é‚£ä¹ˆè¯·å°† `process.env.STL_SKIP_AUTO_CLEANUP` è®¾ç½®ä¸º `true`ï¼Œæˆ–è€…ä»åº“ä¸­å¯¼å…¥ `dont-clean-after-each`ã€‚

```js
import {render, cleanup} from '@testing-library/svelte'

afterEach(() => {
  cleanup()
}) // Default on import: runs it after each test.

render(YourComponent)

cleanup() // Or like this for more control.
```

## `act` (`async`)

ä¸€ä¸ª `å¼‚æ­¥` è¾…åŠ©æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªç«‹å³è¢«è°ƒç”¨/è§£å†³çš„ `function` æˆ– `Promise`ï¼Œ
ç„¶åè°ƒç”¨ [`tick`][svelte-tick]ï¼Œè¿™æ ·æ‰€æœ‰æ‚¬è€Œæœªå†³çš„çŠ¶æ€å˜åŒ–éƒ½è¢«åˆ·æ–°ï¼Œç°åœ¨è§†å›¾åæ˜ äº†å¯¹DOMçš„ä»»ä½•å˜åŒ–ã€‚

## `fireEvent` (`async`)

è°ƒç”¨ `@testing-library/dom` [fireEvent](dom-testing-library/api-events.mdx)ã€‚
è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”±äºè°ƒç”¨ [`tick`][svelte-tick]ï¼Œå®ƒå‘Šè¯‰Svelteåˆ·æ–°æ‰€æœ‰å¾…å®šçš„çŠ¶æ€å˜åŒ–ï¼ŒåŸºæœ¬ä¸Šå®ƒæ›´æ–°DOMä»¥åæ˜ æ–°çš„å˜åŒ–ã€‚

**ç»„ä»¶**

```html
<script>
  let count = 0

  function handleClick() {
    count += 1
  }
</script>

<button on:click="{handleClick}">Count is {count}</button>
```

**æµ‹è¯•**

```js
import '@testing-library/jest-dom'

import {render, fireEvent, screen} from '@testing-library/svelte'

import Comp from '..'

test('count increments when button is clicked', async () => {
  render(Comp)
  const button = screen.getByText('Count is 0')

  // Option 1.
  await fireEvent.click(button)
  expect(button).toHaveTextContent('Count is 1')

  // Option 2.
  await fireEvent(
    button,
    new MouseEvent('click', {
      bubbles: true,
      cancelable: true,
    }),
  )
  expect(button).toHaveTextContent('Count is 2')
})
```

[svelte-tick]: https://svelte.dev/docs#tick
