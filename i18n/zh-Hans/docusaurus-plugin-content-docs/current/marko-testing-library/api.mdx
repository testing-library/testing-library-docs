---
id: api
title: API
---

`Marko Testing Library` é‡æ–°å¯¼å‡ºäº† `DOM Testing Library` çš„æ‰€æœ‰å†…å®¹ä»¥åŠè¿™äº›æ–¹æ³•ï¼š

- [`render`](#render)
  - [`render` é€‰é¡¹](#render-options)
    - [`container`](#container)
- [`render` è¿”å›ç»“æœ](#render-result)
  - [`...queries`](#queries)
  - [`debug`](#debug)
  - [`rerender`](#rerender)
  - [`emitted`](#emitted)
  - [`cleanup`](#cleanup)
  - [`container`](#container-1)
- [`cleanup`](#cleanup-1)

---

## `render`

```javascript
function render(
  template, // A Marko template to render
  input, // Input for the above template
  options // You won't often use this, expand below for docs on options
)
```

æ¸²æŸ“åˆ°ä¸€ä¸ªå®¹å™¨å†…ï¼Œå®¹å™¨é™„åŠ åœ¨ `document.body` ä¸Šã€‚

```javascript
import {render} from '@marko/testing-library'
import MyTemplate from './my-template.marko'

render(MyTemplate)
```

```javascript
import {render, screen} from '@marko/testing-library'
import Greeting from './greeting.marko'

test('renders a message', async () => {
  const {container} = await render(Greeting, {name: 'Marko'})
  expect(screen.getByText(/Marko/)).toBeInTheDocument()
  expect(container.firstChild).toMatchInlineSnapshot(`
    <h1>Hello, Marko!</h1>
  `)
})
```

### `render` é€‰é¡¹

ä½ å¹¶ä¸ç»å¸¸éœ€è¦æŒ‡å®šé€‰é¡¹ï¼Œä½†å¦‚æœä½ éœ€è¦çš„è¯ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¯ç”¨çš„é€‰é¡¹ï¼Œä½ å¯ä»¥ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°æä¾›ç»™ `render`ã€‚

#### `container`

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºå®¢æˆ·ç«¯æµ‹è¯•ï¼Œ`Marko Testing Library`å°†åˆ›å»ºä¸€ä¸ª `div`ï¼Œå¹¶å°†è¯¥ `div` é™„åŠ åˆ° `document.body` ä¸­ï¼Œ
è¿™å°±æ˜¯ä½ çš„ç»„ä»¶å°†è¢«å‘ˆç°çš„åœ°æ–¹ã€‚å¦‚æœä½ é€šè¿‡è¿™ä¸ªé€‰é¡¹æä¾›ä½ è‡ªå·±çš„HTMLElement `container`ï¼Œå®ƒå°†ä¸ä¼šè¢«è‡ªåŠ¨è¿½åŠ åˆ° `document.body` ä¸­ã€‚

æ¯”å¦‚è¯´ã€‚å¦‚æœä½ æ­£åœ¨å•å…ƒæµ‹è¯•ä¸€ä¸ª `tablebody` å…ƒç´ ï¼Œå®ƒä¸èƒ½æ˜¯ä¸€ä¸ª `div` çš„å­å…ƒç´ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ª `table` ä½œä¸ºæ¸²æŸ“ `container`ã€‚

```javascript
const table = document.createElement('table')

const {container} = await render(MyTableBody, null, {
  container: document.body.appendChild(table),
})
```

## `render` è¿”å›ç»“æœ

`render` æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise ä»¥ä¸€ä¸ªå…·æœ‰ä¸€äº›å±æ€§çš„å¯¹è±¡è¿›è¡Œè§£æ:

### `...queries`

`render` æœ€é‡è¦çš„ç‰¹ç‚¹æ˜¯ï¼Œæ¥è‡ª
[æ ¸å¿ƒ API](queries/about.mdx)
çš„æŸ¥è¯¢ä¼šè‡ªåŠ¨è¿”å›ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ¸²æŸ“ä½ çš„ç»„ä»¶çš„ç»“æœç»‘å®šã€‚

æŸ¥çœ‹[æŸ¥è¯¢](queries/about.mdx#types-of-queries)çš„å®Œæ•´åˆ—è¡¨ã€‚

**ç¤ºä¾‹**

```javascript
const {getByLabelText, queryAllByTestId} = await render(MyTemplate)
```

å¦å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨[é¡¶çº§çš„`screen`æ–¹æ³•](queries/about.mdx#screen)æ¥æŸ¥è¯¢ `document.body` ä¸­æ‰€æœ‰å½“å‰æ¸²æŸ“çš„ç»„ä»¶ï¼Œä¾‹å¦‚:

```javascript
import { render, screen } from "@marko/testing-library"

await render(MyTemplate)
const el = screen.getByText(...)
```

### `debug`

è¿™ä¸ªæ–¹æ³•æ˜¯è®°å½• `container` å†…æ‰€æœ‰å­èŠ‚ç‚¹çš„ `prettyDOM` çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ã€‚

```javascript
import {render} from '@marko/testing-library'
import Greeting from './greeting.marko'

const {debug} = await render(Greeting, {name: 'World'})
debug()

// <h1>Hello World</h1>
// you can also pass an element: debug(getByTestId('messages'))
```

è¿™æ˜¯å¯¹ `prettyDOM` çš„ä¸€ä¸ªç®€å•åŒ…è£…ï¼Œå®ƒä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œæ¥è‡ª[`DOM Testing Library`](dom-testing-library/api-debugging.mdx#prettydom)ã€‚

### `rerender`

ä¸€ä¸ªMarkoç»„ä»¶çš„ `input` å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä»ä¸€ä¸ªçˆ¶ç»„ä»¶ä¸­æ”¹å˜ã€‚å°½ç®¡è¿™ç§è¾“å…¥é€šå¸¸æ˜¯é€šè¿‡ä½ çš„ç»„ä»¶å£°æ˜æ€§åœ°ä¼ é€’çš„ï¼Œ
ä½†æœ‰æ—¶æœ‰å¿…è¦ç¡®ä¿ä½ çš„ç»„ä»¶å¯¹æ–°æ•°æ®ä½œå‡ºé€‚å½“çš„ååº”ã€‚ä½ å¯ä»¥é€šè¿‡å°†æ–°çš„æ•°æ®ä¼ é€’ç»™ `rerender` æ¥æ¨¡æ‹Ÿä½ çš„ç»„ä»¶æ¥å—æ–°çš„ `input`ã€‚

```javascript
import {render} from '@marko/testing-library'
import Greeting from './greeting.marko'

const {rerender, debug} = await render(Greeting, {name: 'World'})

// re-render the same component with different props
await rerender({name: 'Marko'})

debug()
// <h1>Hello Marko</h1>
```

### `emitted`

Markoç»„ä»¶ä¹Ÿé€šè¿‡äº‹ä»¶ä¸å®ƒä»¬çš„çˆ¶è¾ˆäº¤æµã€‚å»ºè®®ä½ ä¹Ÿæµ‹è¯•ä¸€ä¸‹ä½ çš„ç»„ä»¶æ˜¯å¦åœ¨æ­£ç¡®çš„æ—¶é—´å‘å‡ºäº†æ­£ç¡®çš„äº‹ä»¶ã€‚

`emitted` å°±æ˜¯è¿™æ ·åšçš„ã€‚è°ƒç”¨å¸®åŠ©å™¨å°†è¿”å›è‡ªä¸Šæ¬¡è°ƒç”¨å¸®åŠ©å™¨ä»¥æ¥çš„æ‰€æœ‰å‘å°„çš„äº‹ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªäº‹ä»¶ç±»å‹æ¥è¿‡æ»¤ç»“æœã€‚

```javascript
import {render, fireEvent} from '@marko/testing-library'
import Counter from './counter.marko'

const {getByText, emitted} = await render(Counter)

const button = getByText('Increment')

await fireEvent.click(button)
await fireEvent.click(button)

// Assuming the `Counter` component forwards these button clicks as `increment` events
expect(emitted('increment')).toHaveProperty('length', 2)

await fireEvent.click(button)

// Note: the tracked events are cleared every time you read them.
// Below we are snapshoting the events after our last assertion,
// the return value will include an array with all of the arguments for each increment event.
expect(emitted('increment')).toMatchInlineSnapshot(`
    Array [
      Array [
        Object {
          "count": 3,
        },
      ],
    ]
`)

// Without an event type will give you all events with their type and arguments.
expect(emitted()).toMatchInlineSnapshot(`
    Array [
      Object {
        "args": Array [
          Object {
            "count": 0,
          },
        ],
        "type": "increment",
      },
      Object {
        "args": Array [
          Object {
            "count": 1,
          },
        ],
        "type": "increment",
      },
      Object {
        "args": Array [
          Object {
            "count": 3,
          },
        ],
        "type": "increment",
      }
    ]
  `)
```

### `cleanup`

[å’Œé¡¶å±‚æ¸…ç†æ–¹æ³•](#cleanup-1)ä¸€æ ·ï¼Œè¿™å…è®¸ä½ åœ¨æµ‹è¯•å®Œæˆä¹‹å‰åˆ é™¤å’Œé”€æ¯å½“å‰æ¸²æŸ“çš„ç»„ä»¶ã€‚

è¿™å¯¹äºéªŒè¯ä¸€ä¸ªç»„ä»¶åœ¨è¢«é”€æ¯åæ˜¯å¦æ­£ç¡®åœ°æ¸…ç†äº†ä»»ä½•DOMçš„çªå˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

```javascript
import {render, screen, getRoles} from '@marko/testing-library'
import Main from './main.marko'
import Dialog from './dialog.marko'

await render(Main)

const main = screen.getByRole('main')
expect(main).not.toHaveAttribute('aria-hidden')

const {cleanup} = await render(Dialog)
expect(main).toHaveAttribute('aria-hidden') // assert added attribute

cleanup() // destroy the dialog

expect(main).not.toHaveAttribute('aria-hidden') // assert attribute removed
```

### `container`

ä½ æ¸²æŸ“çš„Markoç»„ä»¶çš„åŒ…å«DOMèŠ‚ç‚¹ã€‚å¯¹äºæœåŠ¡å™¨ç«¯çš„æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ª[JSDOM.fragment](https://github.com/jsdom/jsdom#fragment)ï¼Œ
è€Œå¯¹äºå®¢æˆ·ç«¯çš„æµ‹è¯•ï¼Œè¿™å°†æ˜¯ä½œä¸º `container` æ¸²æŸ“é€‰é¡¹ä¼ é€’çš„ä»»ä½•å†…å®¹ã€‚

> æç¤ºï¼šè¦è·å¾—æ¸²æŸ“å…ƒç´ çš„æ ¹å…ƒç´ ï¼Œä½¿ç”¨ `container.firstChild`ã€‚

> ğŸš¨ å¦‚æœä½ å‘ç°è‡ªå·±ä½¿ç”¨ `container` æ¥æŸ¥è¯¢æ¸²æŸ“çš„å…ƒç´ ï¼Œé‚£ä¹ˆä½ åº”è¯¥é‡æ–°è€ƒè™‘ï¼å…¶ä»–çš„æŸ¥è¯¢è¢«è®¾è®¡æˆæ›´å®¹æ˜“ä½¿ç”¨ã€‚
> å…¶ä»–çš„æŸ¥è¯¢è¢«è®¾è®¡æˆå¯¹ä½ æ­£åœ¨æµ‹è¯•çš„ç»„ä»¶çš„å˜åŒ–æœ‰æ›´å¼ºçš„é€‚åº”æ€§ã€‚é¿å…ä½¿ç”¨å®¹å™¨æ¥æŸ¥è¯¢å…ƒç´ !

## `fireEvent`

å› ä¸ºMarkoå¯¹DOMçš„æ›´æ–°è¿›è¡Œäº†åˆ†æ‰¹å¤„ç†ï¼Œä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œ[fireEvent](dom-testing-library/api-events.mdx) è¢«ä½œä¸º `async` å‡½æ•°é‡æ–°å¯¼å‡ºã€‚
ç­‰å¾…ç¡®ä¿DOMå·²ç»æ­£ç¡®åœ°æ›´æ–°äº†ï¼Œä»¥å“åº”æµ‹è¯•ä¸­è§¦å‘çš„äº‹ä»¶ã€‚

```js
await fireEvent.click(getByText('Click me'))
```

## `cleanup`

é€šè¿‡å®¢æˆ·ç«¯æµ‹è¯•ï¼Œä½ çš„ç»„ä»¶è¢«æ¸²æŸ“æˆä¸€ä¸ªå ä½çš„HTMLElementã€‚ä¸ºäº†ç¡®ä¿ä½ çš„ç»„ä»¶è¢«æ­£ç¡®åœ°åˆ é™¤å’Œé”€æ¯ï¼Œ
åœ¨æ¯æ¬¡æµ‹è¯•åï¼Œé€šè¿‡ hook æ”¯æŒçš„æµ‹è¯•æ¡†æ¶ä¸­çš„ `afterEach`ï¼Œ`cleanup` æ–¹æ³•ä¼šè‡ªåŠ¨ä¸ºä½ è°ƒç”¨ã€‚
ä½ ä¹Ÿå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ‰‹åŠ¨è°ƒç”¨ `cleanup` æ–¹æ³•ï¼Œè¿™å°†åˆ é™¤æ‰€æœ‰é™„åŠ çš„ç»„ä»¶ã€‚

```javascript
import {render, cleanup, screen} from '@marko/testing-library'
import Greeting from './greeting.marko'

await render(Greeting, {name: 'Marko'})

expect(screen.getByText(/Marko/)).toBeInTheDocument()

// manually cleanup the component before the test is finished
cleanup()
expect(screen.queryByText(/Marko/)).toBeNull()
```

ä½ å¯ä»¥é€šè¿‡å¯¼å…¥ä»¥ä¸‹æ¨¡å—æ¥å…³é—­è‡ªåŠ¨æµ‹è¯•æ¸…ç†åŠŸèƒ½:

```javascript
import '@marko/testing-library/dont-cleanup-after-each'
```

åœ¨mochaä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `mocha -r @marko/testing-library/dont-cleanup-after-each` ä½œä¸ºå¿«æ·æ–¹å¼ã€‚

å¦‚æœä½ ä½¿ç”¨Jestï¼Œä½ å¯ä»¥åœ¨ä½ çš„Jesté…ç½®ä¸­åŠ å…¥ `setupFilesAfterEnv: ["@marko/testing-library/dont-cleanup-after-each"]` ä»¥é¿å…åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­è¿™æ ·åšã€‚
