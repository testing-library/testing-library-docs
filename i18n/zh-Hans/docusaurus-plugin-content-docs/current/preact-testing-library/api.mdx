---
id: api
title: API
sidebar_label: API
---

- [`@testing-library/dom`](#testing-library-dom)
- [`render`](#render)
- [`cleanup`](#cleanup)
- [`act`](#act)
- [`fireEvent`](#fireevent)

---

## `@testing-library/dom`

è¿™ä¸ªåº“é‡æ–°å¯¼å‡ºäº†DOM Testing Libraryï¼ˆ@testing-library/domï¼‰çš„æ‰€æœ‰å†…å®¹ã€‚
è¯·çœ‹[æ–‡æ¡£](queries/about.mdx)ä»¥äº†è§£ä½ å¯ä»¥ä½¿ç”¨å“ªäº›å¥½ä¸œè¥¿ã€‚

## `render`

```jsx
import {render} from '@testing-library/preact'

const {results} = render(<YourComponent />, {options})
```

### é€‰é¡¹

| Option        | Description                                                                                                                                                       | Default       |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| `container`   | The HTML element the component is mounted to.                                                                                                                     | baseElement   |
| `baseElement` | The root HTML element to which the container is appended to.                                                                                                      | document.body |
| `queries`     | Queries to bind to the baseElement. See [within](dom-testing-library/api-within.mdx).                                                                             | null          |
| `hydrate`     | Used when the component has already been mounted and requires a rerender. Not needed for most people. The rerender function passed back to you does this already. | false         |
| `wrapper`     | A parent component to wrap YourComponent.                                                                                                                         | null          |

### è¿”å›ç»“æœ

| Result        | Description                                                                                                                                              |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `container`   | The HTML element the component is mounted to.                                                                                                            |
| `baseElement` | The root HTML element to which the container is appended to.                                                                                             |
| `debug`       | Logs the baseElement using [prettyDom](dom-testing-library/api-debugging.mdx#prettydom).                                                                 |
| `unmount`     | Unmounts the component from the container.                                                                                                               |
| `rerender`    | Calls render again passing in the original arguments and sets hydrate to true.                                                                           |
| `asFragment`  | Returns the innerHTML of the container.                                                                                                                  |
| `...queries`  | Returns all [query functions](queries/about.mdx) to be used on the baseElement. If you pass in `query` arguments than this will be those, otherwise all. |

## `cleanup`

ä»å®¹å™¨ä¸­å¸è½½ç»„ä»¶å¹¶é”€æ¯å®¹å™¨ã€‚

ğŸ“ å½“ä½ ä»åº“ä¸­å¯¼å…¥ä»»ä½•ä¸œè¥¿æ—¶ï¼Œè¿™å°†åœ¨æ¯æ¬¡æµ‹è¯•åè‡ªåŠ¨è¿è¡Œã€‚å¦‚æœä½ æƒ³ç¦ç”¨å®ƒï¼Œ
é‚£ä¹ˆåœ¨è¿è¡Œä½ çš„æµ‹è¯•æ—¶ï¼Œå°† `process.env.PTL_SKIP_AUTO_CLEANUP` è®¾ç½®ä¸º `true`ã€‚

```jsx
import {render, cleanup} from '@testing-library/preact'

afterEach(() => {
  cleanup()
}) // Default on import: runs it after each test.

render(<YourComponent />)

cleanup() // Or like this for more control.
```

## `act`

åªæ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„å¯¼å‡ºï¼ŒæŒ‡å‘ `preact/test-utils/act`ã€‚æ‰€æœ‰è¢«è§¦å‘çš„æ¸²æŸ“å’Œäº‹ä»¶éƒ½è¢«åŒ…è£¹åœ¨ `act` ä¸­ï¼Œ
æ‰€ä»¥ä½ å¹¶ä¸çœŸæ­£éœ€è¦è¿™ä¸ªã€‚å®ƒè´Ÿè´£åœ¨è°ƒç”¨ååˆ·æ–°æ‰€æœ‰çš„æ•ˆæœå’Œé‡æ–°æ¸²æŸ“ã€‚

ğŸ“ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ª[è§£é‡Š](https://github.com/threepointone/react-act-examples/blob/master/sync.md)ã€‚å°½ç®¡å®ƒæ˜¯é’ˆå¯¹Reactçš„ï¼Œä½†å®ƒè®©ä½ çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦å®ƒã€‚

## `fireEvent`

å°†å…¶ä¼ é€’ç»™@testing-library/dom [fireEvent](dom-testing-library/api-events.mdx)ã€‚
å®ƒä¹Ÿè¢«åŒ…è£¹åœ¨ `act` ä¸­ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ‹…å¿ƒåšè¿™ä»¶äº‹ã€‚

ğŸ“ åœ¨ä½¿ç”¨ `h / Preact.createElement` æ—¶ï¼Œè¯·ä¸»è¦è®°ä½Reactä½¿ç”¨çš„æ˜¯åˆæˆäº‹ä»¶ç³»ç»Ÿï¼Œ

è€ŒPreactä½¿ç”¨æµè§ˆå™¨çš„æœ¬åœ° `addEventListener` æ¥å¤„ç†äº‹ä»¶ã€‚è¿™æ„å‘³ç€Reactä¸­çš„ `onChange` å’Œ `onDoubleClick` ç­‰äº‹ä»¶ï¼Œ
åœ¨Preactä¸­æ˜¯ `onInput` å’Œ `onDblClick` ã€‚åŒå‡»çš„ä¾‹å­ä¼šè®©ä½ äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°è¿›è¡Œæµ‹è¯•ã€‚

### ç¤ºä¾‹ 1

```jsx
const cb = jest.fn();

function Counter() {
  useEffect(cb);

  const [count, setCount] = useState(0);

  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}

const { container: { firstChild: buttonNode }, } = render(<Counter />);

// Clear the first call to useEffect that the initial render triggers.
cb.mockClear();

// Fire event Option 1.
fireEvent.click(buttonNode);

// Fire event Option 2.
fireEvent(
  buttonNode,
  new MouseEvent('click', {
    bubbles: true,
    cancelable: true,
    button: 0,
  })
);

expect(buttonNode).toHaveTextContent('1');
expect(cb).toHaveBeenCalledTimes(1);
```

### ç¤ºä¾‹ 2

```jsx
const handler = jest.fn()

const {
  container: {firstChild: input},
} = render(<input type="text" onInput={handler} />)

fireEvent.input(input, {target: {value: 'a'}})

expect(handler).toHaveBeenCalledTimes(1)
```

### ç¤ºä¾‹ 3

```jsx
const ref = createRef()
const spy = jest.fn()

render(
  h(elementType, {
    onDblClick: spy,
    ref,
  }),
)

fireEvent['onDblClick'](ref.current)

expect(spy).toHaveBeenCalledTimes(1)
```
